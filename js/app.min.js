var STONE_BLOCK_WIDTH=101,STONE_BLOCK_HEIGHT=171,util={getRandomInt:function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e},freezeAllEnemies:function(){allEnemies.forEach(function(e){e.freeze()})},unFreezeAllEnemies:function(){allEnemies.forEach(function(e){e.unfreeze()})}},Banner=function(){this.successImage="images/success-key.png",this.gameOverImage="images/game-over.png",this.x=1.25*STONE_BLOCK_WIDTH,this.y=.3*STONE_BLOCK_HEIGHT};Banner.prototype.drawSuccessImage=function(){ctx.drawImage(Resources.get(this.successImage),this.x,this.y)},Banner.prototype.drawGameOverImage=function(){ctx.drawImage(Resources.get(this.gameOverImage),this.x,this.y)};var Enemy=function(e){this.speed=util.getRandomInt(1,200)+200,this.serialNo=e,this.sprite="images/enemy-bug.png",this.calculateX(),this.calculateY()};Enemy.prototype.isOnCanvas=function(){return this.x<550},Enemy.prototype.calculateX=function(){this.blockX=-(2*this.serialNo+1),this.x=this.blockX*STONE_BLOCK_WIDTH},Enemy.prototype.calculateY=function(){switch(this.blockY=util.getRandomInt(1,4),this.blockY){case 1:this.y=1/3*STONE_BLOCK_HEIGHT;break;case 2:this.y=1/3*STONE_BLOCK_HEIGHT+.5*STONE_BLOCK_HEIGHT;break;case 3:this.y=1/3*STONE_BLOCK_HEIGHT+1*STONE_BLOCK_HEIGHT;break;default:throw"invalid track number, please use 1, 2 or 3 to specify the track in the topdown order"}},Enemy.prototype.update=function(e){this.isOnCanvas()?this.x=this.x+this.speed*e:(this.calculateX(),this.calculateY(),this.speed=util.getRandomInt(1,200)+200)},Enemy.prototype.freeze=function(){this.speed=0},Enemy.prototype.unfreeze=function(){this.speed=util.getRandomInt(1,200)+200},Enemy.prototype.render=function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y)};var Player=function(e){this.name=e,this.image="images/char-boy.png",this.success=!1,this.fail=!1,this.initPos()};Player.prototype.initPos=function(){this.blockX=2,this.blockY=4,this.x=this.blockX*STONE_BLOCK_WIDTH,this.y=this.blockY*STONE_BLOCK_HEIGHT/2-20},Player.prototype.checkCollision=function(){var e,t=allEnemies.filter(function(e){var t=!1;if(e.blockY===player.blockY){var i=player.x+25-e.x;t=i>0&&i<=STONE_BLOCK_WIDTH}return t});return e=t.length>0},Player.prototype.update=function(){var e=this.checkCollision();e&&this.initPos()},Player.prototype.render=function(){ctx.drawImage(Resources.get(this.image),this.x,this.y),this.success&&(util.freezeAllEnemies(),banner.drawSuccessImage())},Player.prototype.handleInput=function(e){if(e){switch(e){case"left":this.blockX>0&&(this.x=this.x-STONE_BLOCK_WIDTH,this.blockX--,this.update());break;case"up":this.blockY>1&&(this.y=this.y-STONE_BLOCK_HEIGHT/2,this.blockY--,this.update());break;case"right":this.blockX<4&&(this.x=this.x+STONE_BLOCK_WIDTH,this.blockX++,this.update());break;case"down":this.blockY<5&&(this.y=this.y+STONE_BLOCK_HEIGHT/2,this.blockY++,this.update());break;case"enter":this.success=!1,this.initPos(),util.unFreezeAllEnemies()}1===this.blockY&&(this.success=!0)}};for(var allEnemies=[],i=0;i<5;i++){var serailNo=i+1,enemy=new Enemy(serailNo);allEnemies.push(enemy)}var player=new Player("sunrise2075"),banner=new Banner;document.addEventListener("keyup",function(e){var t={37:"left",38:"up",39:"right",40:"down",13:"enter"};player.handleInput(t[e.keyCode])});
function getRandomInt(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}var STONE_BLOCK_WIDTH=101,STONE_BLOCK_HEIGHT=171,Enemy=function(t){this.speed=getRandomInt(1,200)+200,this.serialNo=t,this.sprite="images/enemy-bug.png",this.calculateX(),this.calculateY()};Enemy.prototype.isOnCanvas=function(){return this.x<550},Enemy.prototype.calculateX=function(){this.blockX=-(2*this.serialNo+1),this.x=this.blockX*STONE_BLOCK_WIDTH},Enemy.prototype.calculateY=function(){switch(this.blockY=getRandomInt(1,4),this.blockY){case 1:this.y=1/3*STONE_BLOCK_HEIGHT;break;case 2:this.y=1/3*STONE_BLOCK_HEIGHT+.5*STONE_BLOCK_HEIGHT;break;case 3:this.y=1/3*STONE_BLOCK_HEIGHT+1*STONE_BLOCK_HEIGHT;break;default:throw"invalid track number, please use 1, 2 or 3 to specify the track in the topdown order"}},Enemy.prototype.update=function(t){this.isOnCanvas()?this.x=this.x+this.speed*t:(this.calculateX(),this.calculateY(),this.speed=getRandomInt(1,200)+200),this.render()},Enemy.prototype.render=function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y)};var Player=function(t){this.name=t,this.image="images/char-boy.png",this.initPos()};Player.prototype.initPos=function(){this.blockX=2,this.blockY=4,this.x=this.blockX*STONE_BLOCK_WIDTH,this.y=this.blockY*STONE_BLOCK_HEIGHT/2-20},Player.prototype.checkCollision=function(){var t=!1,e=allEnemies.filter(function(t){var e=!1;if(t.blockY===player.blockY){var i=player.x+25-t.x;e=i>0&&i<=STONE_BLOCK_WIDTH,e&&(e=!0)}return e});return t=e.length>0},Player.prototype.checkSuccess=function(){return 1===this.blockY},Player.prototype.toPositionInBlock=function(){console.log("blockX:["+this.blockX+"], blockY:["+this.blockY+"]")},Player.prototype.update=function(){var t=this.checkCollision();t&&this.initPos(),this.render()},Player.prototype.render=function(){ctx.drawImage(Resources.get(this.image),this.x,this.y)},Player.prototype.handleInput=function(t){if(t)switch(t){case"left":this.blockX>0&&(this.x=this.x-STONE_BLOCK_WIDTH,this.blockX--,this.update());break;case"up":this.blockY>1&&(this.y=this.y-STONE_BLOCK_HEIGHT/2,this.blockY--,this.update());break;case"right":this.blockX<4&&(this.x=this.x+STONE_BLOCK_WIDTH,this.blockX++,this.update());break;case"down":this.blockY<5&&(this.y=this.y+STONE_BLOCK_HEIGHT/2,this.blockY++,this.update())}};for(var allEnemies=[],i=0;i<5;i++){var serailNo=i+1,enemy=new Enemy(serailNo);allEnemies.push(enemy)}var player=new Player("sunrise2075");document.addEventListener("keyup",function(t){var e={37:"left",38:"up",39:"right",40:"down"};player.handleInput(e[t.keyCode])});